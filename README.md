# Лабораторная работа №1
***
### Отправка запросов с помощью Restlet Clent
---
#### Запрос OPTIONS

Метод OPTIONS выполняет запрос информации об опциях соединения, 
которые поддерживает сервер для запрашиваемого ресурса. Этот метод позволяет клиенту определять опции и/или требования, 
связанные с ресурсом, или возможности сервера, но не производя никаких действий над ресурсом и не инициируя его загрузку.

Если ответ сервера – это не сообщение об ошибке, то заголовки объекта содержат информацию, 
которую можно рассматривать как опции соединения. Например, в заголовке Allow перечислены все методы, 
поддерживаемые сервером для данного ресурса.

Ответы на этот метод не кэшируются. 

**Коды ответа:**
* https://www.apple.com: 200 OK

 >200 OK — успешный запрос. Если клиентом были запрошены какие-либо данные, 
то они находятся в заголовке и/или теле сообщения.
* http://mail.ru: 400 Bad Request
 >400 Bad Request — сервер обнаружил в запросе клиента синтаксическую ошибку.
* http://ya.ru: 403 Forbidden
* https://www.rambler.ru: 403 Forbidden
 >403 Forbidden — сервер понял запрос, но он отказывается его выполнять из-за ограничений в доступе для 
клиента к указанному ресурсу. Иными словами, клиент не уполномочен совершать операции с запрошенным ресурсом.
* https://github.com: 404 Not Found
 >404 Not Found — самая распространённая ошибка при пользовании Интернетом, основная причина — ошибка 
в написании адреса Web-страницы. Сервер понял запрос, но не нашёл соответствующего ресурса по указанному URL.
* https://www.google.com: 405 Method Not Allowed
 >405 Method Not Allowed — указанный клиентом метод нельзя применить к текущему ресурсу. 
В ответе сервер должен указать доступные методы в заголовке Allow, разделив их запятой.

> Allow: GET, HEAD

Правильно обработал запрос только сайт www.apple.com. Он вернул следующие данные:
> Allow: GET, HEAD, POST, OPTIONS  

#### Запрос HEAD

Метод HEAD идентичен GET, за исключением того, что сервер не возвращает в ответе тело сообщения. 
Информация, содержащаяся в HTTP заголовках ответа на запрос HEAD, идентична информации, представляемой 
в ответ на запрос GET для того же ресурса. Запрос HEAD обычно применяется для извлечения метаданных, 
проверки наличия ресурса (валидация URL) и чтобы узнать, не изменился ли он с момента последнего обращения.

**Коды ответа:**
* https://www.apple.com: 200 OK
* https://www.msn.com: 302 Found
>302 Found — запрошенный документ временно доступен по другому URI, указанному в заголовке в поле Location

> status:	302  
location:	https://www.msn.com/ru-ru/

* https://vk.com: 501 Not Implemented
>501 Not Implemented — сервер не поддерживает возможностей, необходимых для обработки запроса. Типичный ответ для случаев, когда сервер не понимает указанный в запросе метод.

Сайт www.apple.com прислал ответ:
>Server:	Apache  
X-Frame-Options:	SAMEORIGIN  
X-Xss-Protection:	1; mode=block  
Accept-Ranges:	bytes  
X-Content-Type-Options:	nosniff  
Content-Type:	text/html; charset=UTF-8  
Vary:	Accept-Encoding  
Content-Encoding:	gzip  
Cache-Control:  
max-age=2m 44s  
Expires:	 
Wed, 28 Nov 2018 04:14:14 GMT+2m 25s  
Date:	 
Wed, 28 Nov 2018 04:11:30 GMT-19s  
Content-Length:	7 kilobytes  
Connection:	keep-alive  

#### Запрос GET

Метод GET позволяет получать любую информацию, 
связанную с запрашиваемым ресурсом. В большинстве случаев, 
если идентификатор запрашиваемого ресурса указывает на 
документ (например, документ HTML, текстовый документ, 
графическое изображение, видеоролик), 
то сервер возвращает содержимое этого документа 
(содержимое файла). Если запрашиваемый ресурс является 
приложением (программой), формирующим в процессе своей 
работы некоторые данные, то в теле сообщения ответа 
возвращаются эти данные, а не двоичный образ выполняемого файла. Если идентификатор запрашиваемого ресурса указывает на директорию (каталог, папку), то, в зависимости от настроек сервера, может быть возвращено либо содержимое директории (список файлов), либо содержимое одного из файлов, находящегося в этой директории (как правило, index.html или Default.htm).

**Коды ответа:** 
* https://yandex.ru: 200 OK
* https://www.apple.com: 200 OK
* https://www.google.com: 200 OK

В теле ответа содержится содержимое документа HTML.

#### Запрос POST
Метод POST используется для запроса, при котором адресуемый 
сервер принимает данные, включенные в тело сообщения (объект) 
запроса, и отправляет их на обработку приложению, указанному 
как запрашиваемый ресурс. При результате выполнения 200 (Ok) 
в тело ответа следует включить сообщение об итоге выполнения 
запроса. Если был создан ресурс, то серверу следует вернуть 
ответ 201 (Created) с указанием URI нового ресурса в заголовке 
Location.

**Коды ответа:** 
* https://www.google.com: 405 Method Not Allowed
* https://yandex.ru: 403 Forbidden
* https://www.apple.com: 200 OK

Без ошибок запрос обработал только www.apple.com. 
В теле ответа содержится содержимое документа HTML.


### Работа с api сайта
---

Чтобы обратиться к методу API ВКонтакте, необходимо выполнить POST или GET запрос такого вида:
https://api.vk.com/method/METHOD_NAME?PARAMETERS&access_token=ACCESS_TOKEN&v=V
, где :
* METHOD_NAME (обязательно) — название метода API, к которому требуется обращение.
* PARAMETERS (опционально) — входные параметры соответствующего метода API, последовательность пар name=value, разделенных амперсандом.
* ACCESS_TOKEN (обязательно) — ключ доступа.
* V (обязательно) — используемая версия API. На текущий момент актуальная версия API — 5.92.

#### Получить список всех факультетов МГТУ им. Н.Э.Баумана.

С помощью метода database.getUniversities был получен список высших учебных заведений в Москве, 
в названии которых присутвуют слова "МГТУ им Баумана".

Сформированный запрос: 
https://api.vk.com/method/database.getUniversities?q=МГТУ%20им%20Баумана&country_id=1&city_id=1&access_token=ACCESS_TOKEN&v=5.92

Тело ответа состоит из объекта, содержащего число результатов в поле count, и массива объектов, описывающих университеты, в поле items:
```
{
  "response": {
    "count": 2,
    "items": [
      {
        "id": 250,
        "title": "МГТУ им. Н. Э. Баумана"
      },
      {
        "id": 169759,
        "title": "ИСОТ МГТУ им. Баумана (бывш. МИПК МГТУ им. Баумана)"
      }
    ]
  }
}
```

Таким образом, МГТУ им.Н.Э.Баумана имеет идентификатор (id) 250. С помощью метода database.getFaculties по 
id вуза можно получить список его факультетов. Для этого был сформирован следующий запрос:
https://api.vk.com/method/database.getFaculties?university_id=250&access_token=ACCESS_TOKEN&v=5.92

Тело ответа состоит из объекта, содержащего число результатов в поле count, и массива объектов, описывающих факультеты, в поле items:
```
{
  "response": {
    "count": 20,
    "items": [
      {
        "id": 1031,
        "title": "Аэрокосмический факультет"
      },
      {
        "id": 1032,
        "title": "Факультет инженерного бизнеса и менеджмента"
      },
      {
        "id": 1033,
        "title": "Факультет информатики и систем управления"
      },
      {
        "id": 1034,
        "title": "Факультет машиностроительных технологий"
      },
      {
        "id": 1035,
        "title": "Факультет оптико-электронного приборостроения"
      },
      {
        "id": 1036,
        "title": "Приборостроительный факультет"
      },
      {
        "id": 1037,
        "title": "Радиотехнический факультет"
      },
      {
        "id": 1038,
        "title": "Факультет радиоэлектроники и лазерной техники"
      },
      {
        "id": 1039,
        "title": "Факультет ракетно-космической техники"
      },
      {
        "id": 1040,
        "title": "Факультет робототехники и комплексной автоматизации"
      },
      {
        "id": 1041,
        "title": "Факультет специального машиностроения"
      },
      {
        "id": 1042,
        "title": "Факультет фундаментальных наук"
      },
      {
        "id": 1043,
        "title": "Факультет энергомашиностроения"
      },
      {
        "id": 1044,
        "title": "Кафедра юриспруденции, интеллектуальной собственности и судебной экспертизы"
      },
      {
        "id": 1803,
        "title": "Факультет биомедицинской техники"
      },
      {
        "id": 1804,
        "title": "Факультет социально-гуманитарных наук"
      },
      {
        "id": 56430,
        "title": "Факультет лингвистики"
      },
      {
        "id": 56431,
        "title": "Физкультурно-оздоровительный факультет"
      },
      {
        "id": 2071503,
        "title": "Головной учебно-исследовательский и методический центр (ГУИМЦ)"
      },
      {
        "id": 2183736,
        "title": "Факультет военного обучения (Военный институт)"
      }
    ]
  }
}
```

#### Получить свою аватарку

Для получения информации о пользователях используется метод users.get. Он принимает параметр fields, задающий список дополнительных полей профилей, которые необходимо вернуть. Для получения аватарки текущего пользователя (своей аватарки) был сформирован запрос:
https://api.vk.com/method/users.get?fields=photo_max_orig&access_token=ACCESS_TOKEN&v=5.92

Тело ответа содержит массив объектов пользователей:

```
{
     "response":[
         {
          "id": 32766100,
          "first_name": "Иван",
          "last_name": "Мурашов",
          "is_closed": true,
          "can_access_closed": true,
          "photo_max_orig": "https://pp.userapi.com/c851324/v851324240/3a17b/MuC43KZrUJM.jpg?ava=1"
         }
      ]
}
```

Во всех случаях от api присылался код ответа 200 OK. Данные приходили в формате json, кодировке utf-8. 
На запросы отвечал веб-сервер nginx. Использовалась версия протокола HTTP/1.1.

#### Отправка записи на стену
Метод wall.post позволяет создать запись на стене. С помощью формы, встроенной в документацию api, были заданы параметры owner_id - идентификатор пользователя, на стене которого должна быть опубликована запись, и message - текст сообщения.
https://api.vk.com/method/wall.post?owner_id=190255986&message=Сюда иди да :*&access_token=ACCESS_TOKEN&v=5.92
После нажатия на кнопку "Выполнить" был получен ответ, содержащий id новой записи в поле post_id:
```
{
  "response": {
    "post_id": 152
  }
}
```

В POST-запросах данные от пользователя к серверу передаются в теле сообщения.


### Реализация серверного приложения

С использованием фреймворка NodeJS + express было реализовано серверное приложение. Данные хранятся в RAM в виде массива. 
Каждая запись имеет поля: id, value

Прочитать все записи можно с помощью GET-запроса по URL http://localhost:3000/notes. Пример тела ответа:
```
[{
  "id":"0",
  "value":"my null value"
},
{
  "id":"1",
  "value":"something"
}]
```

Используя POST-запрос по URL http://localhost:3000/notes, можно добавить запись. При этом в тело запроса нужно передать параметр value. В теле ответа в формате json отобразится добавленная запись:
```
[
{
  "id":"2",
  "value":"2some"
}]
```

Запрос по URL http://localhost:3000/notes/id=:id, где id передается как параметр, вернет запись с запрошенным id в формате json или весь массив, если записи с таким id нет.

Обновление записей происходит с помощью PUT-запроса по URL http://localhost:3000/notes/id=:id. В теле ответа вернется обновленная запись. Если записи с указанным id не было найдено, будет создана новая. 

Удалить запись можно DELETE-запросом по URL http://localhost:3000/notes/value=:value. В теле ответа вернется результирующий массив в формате json или сообщение об ошибке, если записи с таким value нет.  
Также запись можно удалить по id: http://localhost:3000/notes/id=:id

Результат запроса OPTIONS по URL http://localhost:3000/notes :
> Allow: GET,HEAD,POST

### Статика и маршрутизация
Добавлена папка static, в ней созданы папки html и img. В папке html созданы файлы index.html и nor.txt.

Результат GET-запроса по URL http://localhost:3000/

```
<html>
  <head></head>
  <body>
    <h1>Здесь текст</h1>
    <a href="http://127.0.0.1:3000/nor">Стучат здесь</a>
    <a href="http://127.0.0.1:3000/nor"><img width="600" src="/img/sha.jpg"></a>
  </body>
</html>
```

Результат GET-запроса по URL http://localhost:3000/nor
```
<html>
  <head></head>
  <body>
    <img src="/img/nor.gif" width="1400" height="800"/>
  </body>
</html>
```

Если переименовать файл nor.html в nor.txt, браузер отобразит на странице теги html в текстовом виде. Чтобы страница отображалась корректно, нужно установить значение 'text\html' в поле 'Content-Type' заголовка ответа.

